<!DOCTYPE html>
<html lang="fa" dir="rtl" id="html-tag">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bamboo Meme Maker</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lalezar&family=Poppins:wght@400;600;700;900&family=Vazirmatn:wght@400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <link rel="stylesheet" href="style.css?v=5">
</head>
<body>

    <div class="bg-3d-container">
        <div class="bamboo-bg-text">BAMBOO</div>
        <div class="shape-3d blob-1"></div>
        <div class="shape-3d blob-2"></div>
        <div class="shape-3d blob-3"></div>
        <div class="shape-3d blob-4"></div>
        <div class="shape-3d blob-5"></div>
    </div>

    <button id="lang-btn" class="glass-btn">
        <span class="lang-icon">๐</span>
        <span id="lang-text">EN</span>
    </button>

    <button id="wallet-btn" class="glass-btn" title="ฺฉู ูพูู ุงุณุชุงุฑุฒ">
        <span class="star-icon">โญ</span>
        <span id="wallet-balance">0</span>
    </button>

    <div id="splash-screen" class="screen-layer active">
        <div class="loader">
            <div class="bamboo-stick"></div>
            <div class="bamboo-stick delay-1"></div>
            <div class="bamboo-stick delay-2"></div>
        </div>
        <h2 class="splash-text">Bamboo Factory...</h2>
    </div>

    <div id="landing-page" class="screen-layer glass-panel" style="display: none;">
        <h1 id="landing-title">ุจุงูุจู ูู ๐</h1>
        <p id="landing-desc" class="subtitle">ุฎูุงูุชุช ุฑู ุฑูุง ฺฉู!</p>
        
        <div class="menu-buttons">
            <button id="start-app-btn" class="main-btn glass-btn-primary">๐จ ูุฑูุฏ ุจู ููโุณุงุฒ</button>
            <button id="support-btn" class="secondary-btn glass-btn-sec" style="border-color: #d97706; color: #d97706;">๐ฌ <span id="support-btn-txt">ูพุดุชุจุงู ู ููฺฉุงุฑ</span></button>
            <button id="channel-btn" class="secondary-btn glass-btn-sec">๐ข ฺฉุงูุงู ูุง</button>
        </div>
    </div>

    <div id="app-container" class="screen-layer glass-panel" style="display: none;">
        <h1 id="title-text">ููโุณุงุฒ ุญุฑููโุง ๐จ</h1>
        
        <div id="step-1">
            <button id="back-to-menu-btn" class="secondary-btn glass-btn-sec" style="margin-bottom: 15px; border-color: #9ca3af; color: #4b5563;">๐ ููู ุงุตู</button>
            
            <input type="file" id="image-upload" accept="image/*" style="display: none;">
            
            <button id="upload-btn" class="main-btn glass-btn-green" style="margin-bottom: 15px;">
                ๐ธ ุขูพููุฏ ุงุฒ ฺฏุงูุฑ ฺฏูุด
            </button>

            <input type="text" id="search-input" placeholder="๐ ุฌุณุชุฌู ููโูุง ุชุฑูุฏ..." class="search-box glass-input">

            <div class="gallery glass-gallery" id="template-gallery">
                <p id="loading-text" style="color: #555; font-weight: bold; width: 100%;">โณ ุฏุฑ ุญุงู ุฏุฑุงูุช ุชุตุงูุฑ...</p>
            </div>
            
            <button id="load-more-btn" class="secondary-btn glass-btn-sec hidden" style="width: 100%; margin-top: 10px;">ููุงุด ุจุดุชุฑ</button>
            <button id="next-btn" class="main-btn glass-btn-primary" disabled style="margin-top: 15px;">ูุฑุญูู ุจุนุฏ</button>
        </div>

        <div id="step-2" style="display: none;">
            <div class="canvas-wrapper">
                <canvas id="meme-canvas"></canvas>
            </div>
            
            <div class="floating-toolbar glass-toolbar">
                <button id="add-text-btn" class="tool-btn add">
                    <span class="btn-icon">T+</span>
                    <span class="btn-label" id="add-text-label">ุงูุฒูุฏู ูุชู</span>
                </button>
                
                <div id="edit-tools" style="display: none; width: 100%; gap: 10px; justify-content: space-between;">
                    <button id="edit-text-btn" class="tool-btn" style="background: #3b82f6; width: 50%; justify-content: center;">
                        <span class="btn-icon">โ๏ธ ูุฑุงุด</span>
                    </button>
                    <button id="delete-text-btn" class="tool-btn delete" style="width: 50%; margin: 0; border-radius: 15px;">
                        <span class="btn-icon">๐๏ธ ุญุฐู</span>
                    </button>
                </div>
            </div>
            
            <div class="action-buttons">
                <button id="back-btn" class="secondary-btn glass-btn-sec">ุจุงุฒฺฏุดุช</button>
                <button id="download-btn" class="main-btn glass-btn-primary telegram-btn">ุงุฑุณุงู ุจู ุจุงุช ๐ฅ</button>
            </div>
            <button id="share-btn" class="share-btn-full glass-btn-outline">ุงุดุชุฑุงฺฉโฺฏุฐุงุฑ ๐</button>
        </div>
    </div>

    <div id="force-join-modal" class="glass-panel" style="display: none; position: fixed; z-index: 9999; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 85%; max-width: 400px; padding: 20px;">
        <h3 id="join-title" style="color: #ef4444; margin-top: 0; margin-bottom: 10px;">ุนุถูุช ุงุฌุจุงุฑ ๐จ</h3>
        <p id="join-desc" style="font-size: 0.95rem; color: #555; margin-bottom: 20px; font-weight: bold;">ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุฑุจุงุช ูุทูุง ุงุจุชุฏุง ุฏุฑ ฺฉุงูุงู ูุง ุนุถู ุดูุฏ.</p>
        <div style="display: flex; flex-direction: column; gap: 10px;">
            <button id="join-channel-btn" class="main-btn glass-btn-primary" style="background: linear-gradient(135deg, #3b82f6, #2563eb); border: none; color: #fff;">๐ข ุนุถูุช ุฏุฑ ฺฉุงูุงู</button>
            <button id="check-join-btn" class="main-btn glass-btn-green">๐ ุนุถู ุดุฏู (ุจุฑุฑุณ)</button>
            <button id="close-join-btn" class="secondary-btn glass-btn-sec" style="border-color: #ef4444; color: #ef4444;">โ ุจุณุชู</button>
        </div>
    </div>

    <div id="store-page" class="screen-layer glass-panel" style="display: none;">
        <button id="back-from-store-btn" class="secondary-btn glass-btn-sec" style="margin-bottom: 20px; border-color: #9ca3af; color: #4b5563;">โฌ๏ธ ุจุงุฒฺฏุดุช</button>
        
        <h1 id="store-title" style="color: #ca8a04; margin-top: 0; margin-bottom: 10px; font-weight: 900;">ูุฑูุดฺฏุงู ุงุณุชุงุฑุฒ โญ</h1>
        <p id="store-desc" style="font-size: 0.95rem; color: #555; margin-bottom: 20px; font-weight: bold;">
            <span id="store-desc-text">ููุฌูุฏ ูุนู ุดูุง:</span> 
            <b id="store-balance-text" style="color:#ca8a04; font-size:1.3rem;">0</b> โญ
        </p>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px;">
            <button class="buy-stars-btn main-btn" data-amount="50" style="background: linear-gradient(135deg, #fef08a, #eab308); color: #854d0e; border: none; font-size: 1.1rem; box-shadow: 0 4px 10px rgba(234, 179, 8, 0.3);">โญ 50</button>
            <button class="buy-stars-btn main-btn" data-amount="100" style="background: linear-gradient(135deg, #fde047, #ca8a04); color: #713f12; border: none; font-size: 1.1rem; box-shadow: 0 4px 10px rgba(202, 138, 4, 0.3);">โญ 100</button>
            <button class="buy-stars-btn main-btn" data-amount="150" style="background: linear-gradient(135deg, #facc15, #a16207); color: #fff; border: none; font-size: 1.1rem; box-shadow: 0 4px 10px rgba(161, 98, 7, 0.3);">โญ 150</button>
            <button class="buy-stars-btn main-btn" data-amount="500" style="background: linear-gradient(135deg, #eab308, #713f12); color: #fff; border: none; font-size: 1.1rem; box-shadow: 0 4px 10px rgba(113, 63, 18, 0.4);">โญ 500</button>
        </div>

        <div class="terms-box">
            <h4 id="store-terms-title" style="color: #ef4444; margin-top: 0; margin-bottom: 8px; font-size: 0.95rem;">ููุงูู ู ููุฑุฑุงุช โ๏ธ</h4>
            <p id="store-terms-desc" style="color: #7f1d1d; font-size: 0.8rem; margin: 0; line-height: 1.6; font-weight: 600;">
                ุฎุฑุฏูุง ุดูุง ุจุง ูุณุฆููุช ุฎูุฏุชูู ูุณุชุด ู ุจุฎุงุทุฑ ุดุฑุงุท ู ูุญุฏูุฏุชโูุง ุชูฺฏุฑุงู ุฏุฑุฎูุงุณุช ุจุฑฺฏุดุช ูุฌู ููุฏูุฑ ููโุจุงุดุฏ. ูุทูุงู ุฏุฑ ุฎุฑุฏ ุฎูุฏ ุฏูุช ฺฉูุฏ.
            </p>
        </div>
    </div>

    <div id="support-modal" class="glass-panel" style="display: none; position: fixed; z-index: 9999; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 85%; max-width: 400px; padding: 20px;">
        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
            <button id="tab-support-btn" class="main-btn glass-btn-primary" style="flex: 1; padding: 10px;">๐๏ธ ูพุดุชุจุงู</button>
            <button id="tab-collab-btn" class="secondary-btn glass-btn-sec" style="flex: 1; padding: 10px;">๐ค ููฺฉุงุฑ</button>
        </div>
        <div id="form-support-view">
            <textarea id="support-text" class="glass-input text-area-main" rows="3" placeholder="ูุดฺฉู ุง ุณูุงูุชูู ุฑู ุจููุณุฏ..." style="resize: none;"></textarea>
            <input type="file" id="support-file-upload" accept="image/*" style="display: none;">
            <button id="support-img-btn" class="secondary-btn glass-btn-sec" style="margin-bottom: 15px; font-size: 0.9rem; border-style: dashed;">๐ ุถููู ุนฺฉุณ (ุงุฎุชุงุฑ)</button>
            <p id="support-file-name" style="color: var(--bamboo-green); font-size: 0.8rem; margin-top: -10px; margin-bottom: 15px; display: none;">ุนฺฉุณ ุงูุชุฎุงุจ ุดุฏ โ</p>
        </div>
        <div id="form-collab-view" style="display: none;">
            <input type="text" id="collab-channel" class="glass-input" placeholder="ุขุฏ ฺฉุงูุงู (ูุซุงู: mychannel@)">
            <input type="text" id="collab-telegram" class="glass-input" placeholder="ุขุฏ ุชูฺฏุฑุงู ุดูุง">
            <textarea id="collab-extra" class="glass-input text-area-main" rows="2" placeholder="ุชูุถุญุงุช ุชฺฉูู..." style="resize: none; margin-bottom: 15px;"></textarea>
        </div>
        <div style="display: flex; gap: 10px;">
            <button id="send-support-btn" class="main-btn glass-btn-primary" style="flex: 1; background: linear-gradient(135deg, #facc15, #eab308); border: none; color: #fff;">ุงุฑุณุงู ๐</button>
            <button id="close-support-btn" class="secondary-btn glass-btn-sec" style="flex: 1; border-color: #ef4444; color: #ef4444;">ุจุณุชู โ</button>
        </div>
    </div>

    <div id="text-edit-panel" class="bottom-sheet glass-panel" style="transform: translateY(120%);">
        <div class="sheet-handle"></div>
        <h3 id="panel-title">ูุฑุงุด ูุชู โ๏ธ</h3>
        
        <div style="display: flex; gap: 8px; margin-bottom: 15px;">
            <textarea id="text-input-field" class="glass-input text-area-main" rows="2" placeholder="ูุชู ุฎูุฏ ุฑุง ุงูุฌุง ุจููุณุฏ..." style="margin-bottom: 0; width: 80%;"></textarea>
            <button id="inline-close-btn" class="main-btn glass-btn-primary" style="width: 20%; padding: 0; display: flex; align-items: center; justify-content: center; font-size: 24px;">โ๏ธ</button>
        </div>
        
        <div class="control-group">
            <label id="font-label">ูููุช:</label>
            <select id="font-family" class="glass-input">
                <option value="Lalezar">ูุงููโุฒุงุฑ (ุถุฎู ูุงุฑุณ)</option>
                <option value="Vazirmatn">ูุฒุฑูุชู (ุฎูุงูุง)</option>
                <option value="Impact">Impact (ูู ุงูฺฏูุณ)</option>
                <option value="Poppins">Poppins (ูุฏุฑู)</option>
            </select>
        </div>
        
        <div class="control-group">
            <label id="size-label">ุงูุฏุงุฒู:</label>
            <input type="range" id="font-size" min="15" max="150" value="40" class="glass-slider">
        </div>

        <div class="color-controls">
            <div class="color-picker-wrapper" title="ุฑูฺฏ ูุชู">
                <input type="color" id="text-color" value="#ffffff">
                <div class="color-icon" id="color-indicator" style="background-color: #ffffff;"></div>
            </div>
            <span style="font-weight: bold; color: var(--bamboo-dark);" id="color-lbl">ุฑูฺฏ ูุชู</span>
            
            <div class="color-picker-wrapper" title="ุฑูฺฏ ุญุงุดู">
                <input type="color" id="stroke-color" value="#000000">
                <div class="color-icon" id="stroke-indicator" style="background-color: #000000;"></div>
            </div>
            <span style="font-weight: bold; color: var(--bamboo-dark);" id="stroke-lbl">ุญุงุดู</span>
        </div>
    </div>

    <script src="script.js?v=5"></script>
</body>
</html>